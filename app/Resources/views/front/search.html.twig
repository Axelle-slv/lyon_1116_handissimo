{% extends 'base.html.twig' %}
{% block title %}Handissimo | Voici les résultats de votre recherche.{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/map.css') }}">
    <link rel="stylesheet" href="{{ asset('css/search.css') }}">
{% endblock %}
{% block body %}
    <section class="container-fluid blue" id="research">
        <div class="row">
            <div class="container" id="search-done">
                {{ form_start(form) }}
                {{ form_errors(form) }}
                <div class="col-xs-12 col-md-4">
                    <p class="search-label">Que cherchez-vous ?</p>
                    {{ form_row(form.keyword, { 'attr':{"value":keyword["keyword"]}}) }}
                    <ul id="keywordautocomplete"></ul>
                </div>
                <div class="col-xs-12 col-md-2">
                    <p class="search-label">Âge</p>
                    {{ form_row(form.age, { 'attr':{"value":age}}) }}
                </div>
                <div class="col-xs-12 col-md-4">
                    <p class="search-label">Où ?</p>
                    {{ form_row(form.postal, { 'attr':{"value":keyword["postal"]}}) }}
                    <ul id="city"></ul>
                </div>

                <div class="col-md-2">
                    {{ form_row(form.save, {'attr': {'class': 'btn black-btn'}}) }}
                </div>
            </div>
        </div>

        <div class="container">
            <div class="col-md-3">
                <button type="button" class="btn btn-link" data-toggle="collapse" data-target="#filters" id="btn-filter">Affinez votre recherche</button>
            </div>
        </div>

        <div class="container">
            <div id="filters" class="collapse">
                <div class="col-md-4">
                    {{ form_row(form.structurestypes) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.disabilitytypes) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.needs) }}
                </div>
                    {{ form_end(form) }}
            </div>
        </div>
    </section>
    <section class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <div class="row">
                    <div id="map"></div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="col-xs-12">
                    <div class="count">
                        <h4>{{ pagination.getTotalItemCount }} résultat(s)</h4>
                    </div>
                </div>
                {% for results in pagination %}
                <div class="row">
                    <div class="col-md-3">
                        <img src="" class="img-responsive" alt="Responsive image" id="img-search">
                    </div>
                    <div class="col-md-9">
                        <h4 class="searchtitre">{{ results.name }}</h4>
                        <p class="address">{{ results.address }}<br>
                        {{ results.postal }} {{ results.city }}</p>
                        <p>{{ results.organizationDescription }}</p>
                    </div>

                    {% set array = {
                        'name': results.name,
                        'address': results.address,
                        'postal': results.postal,
                        'city': results.city,
                        'number': results.phoneNumber,
                        'mail': results.mail,
                        'web': results.website,
                        'latitude': results.latitude,
                        'longitude': results.longitude,
                        }
                    %}

                    {% set arrayjson = array|json_encode %}
                    <input type="hidden" class="arrayjson" value="{{ arrayjson }}" />
                </div>
                {% else %}
                <div class="container" id="searchnull">
                    <br>
                    <br>
                    <br>
                    <h1>Aucun Résultat<br>
                        ne Correspond à la recherche</h1>
                </div>
                {% endfor %}
                <div class="navigation">
                    {{ knp_pagination_render(pagination) }}
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="{{ asset ('js/googlemap.js')}}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT1ybqTsqE0Nzit6xL7PfZWcgnLmThfXc&callback=initMap">
    </script>
{% endblock %}